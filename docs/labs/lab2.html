<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Lab 2: Minnesota tree growth – ESS 330</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-dark-8ea72dc5fed832574809a9c94082fbbb.css" rel="prefetch" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap-5b6eb65566b1f8a996f1287d789c0740.min.css" rel="stylesheet" append-hash="true" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../site_libs/bootstrap/bootstrap-dark-c63d9198b28a859559c0f0cce9729cfa.min.css" rel="prefetch" append-hash="true" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../csu-rams-logo.png" alt="" class="navbar-logo">
    </a>
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ESS 330</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../syllabus.html"> 
<span class="menu-text">Syllabus</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../labs.html"> 
<span class="menu-text">Labs</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/mikejohnson51/csu-ess-330/"> <i class="bi bi-github" role="img" aria-label="ESS 330">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#intro-to-dplyr" id="toc-intro-to-dplyr" class="nav-link active" data-scroll-target="#intro-to-dplyr">Intro to <code>dplyr</code>:</a>
  <ul class="collapse">
  <li><a href="#key-features-of-dplyr" id="toc-key-features-of-dplyr" class="nav-link" data-scroll-target="#key-features-of-dplyr">Key Features of dplyr</a></li>
  <li><a href="#rows" id="toc-rows" class="nav-link" data-scroll-target="#rows">Rows:</a></li>
  <li><a href="#columns" id="toc-columns" class="nav-link" data-scroll-target="#columns">Columns:</a></li>
  <li><a href="#groups-of-rows" id="toc-groups-of-rows" class="nav-link" data-scroll-target="#groups-of-rows">Groups of rows:</a></li>
  <li><a href="#glimpse" id="toc-glimpse" class="nav-link" data-scroll-target="#glimpse">Glimpse</a></li>
  <li><a href="#piping" id="toc-piping" class="nav-link" data-scroll-target="#piping">Piping</a>
  <ul class="collapse">
  <li><a href="#base-r-pipe-introduced-in-r-4.1.0-the-native-pipe-works-similarly-to-the-magrittr-pipe-but-is-built-into-base-r." id="toc-base-r-pipe-introduced-in-r-4.1.0-the-native-pipe-works-similarly-to-the-magrittr-pipe-but-is-built-into-base-r." class="nav-link" data-scroll-target="#base-r-pipe-introduced-in-r-4.1.0-the-native-pipe-works-similarly-to-the-magrittr-pipe-but-is-built-into-base-r.">Base R Pipe (|&gt;): Introduced in R 4.1.0, the native pipe (|&gt;) works similarly to the magrittr pipe (%&gt;%) but is built into base R.</a></li>
  <li><a href="#tidyverse-pipe" id="toc-tidyverse-pipe" class="nav-link" data-scroll-target="#tidyverse-pipe">Tidyverse Pipe (%&gt;%)</a></li>
  <li><a href="#key-differences" id="toc-key-differences" class="nav-link" data-scroll-target="#key-differences">Key Differences</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#minnesota-tree-growth-data" id="toc-minnesota-tree-growth-data" class="nav-link" data-scroll-target="#minnesota-tree-growth-data">Minnesota tree growth data:</a></li>
  <li><a href="#exercises" id="toc-exercises" class="nav-link" data-scroll-target="#exercises">Exercises</a>
  <ul class="collapse">
  <li><a href="#filtering-rows" id="toc-filtering-rows" class="nav-link" data-scroll-target="#filtering-rows">1 Filtering rows</a></li>
  <li><a href="#slicing-rows" id="toc-slicing-rows" class="nav-link" data-scroll-target="#slicing-rows">2. Slicing rows</a></li>
  <li><a href="#arranging-rows" id="toc-arranging-rows" class="nav-link" data-scroll-target="#arranging-rows">3 Arranging Rows</a></li>
  <li><a href="#reducing-columns" id="toc-reducing-columns" class="nav-link" data-scroll-target="#reducing-columns">4 Reducing Columns</a></li>
  <li><a href="#renaming-columns" id="toc-renaming-columns" class="nav-link" data-scroll-target="#renaming-columns">5. Renaming columns</a></li>
  <li><a href="#creating-new-columns" id="toc-creating-new-columns" class="nav-link" data-scroll-target="#creating-new-columns">6 Creating new columns</a></li>
  <li><a href="#case_when-if_esle" id="toc-case_when-if_esle" class="nav-link" data-scroll-target="#case_when-if_esle">7 case_when / if_esle</a></li>
  <li><a href="#summarizing" id="toc-summarizing" class="nav-link" data-scroll-target="#summarizing">8. Summarizing</a></li>
  <li><a href="#grouped-data" id="toc-grouped-data" class="nav-link" data-scroll-target="#grouped-data">9 Grouped data</a>
  <ul class="collapse">
  <li><a href="#how-do-dplyr-functions-behave-given-a-grouped-data.frame" id="toc-how-do-dplyr-functions-behave-given-a-grouped-data.frame" class="nav-link" data-scroll-target="#how-do-dplyr-functions-behave-given-a-grouped-data.frame">How do <code>dplyr</code> functions behave given a grouped <code>data.frame</code>?</a></li>
  </ul></li>
  <li><a href="#counting" id="toc-counting" class="nav-link" data-scroll-target="#counting">10 Counting</a></li>
  </ul></li>
  <li><a href="#final-question" id="toc-final-question" class="nav-link" data-scroll-target="#final-question">Final Question:</a></li>
  <li><a href="#rubric" id="toc-rubric" class="nav-link" data-scroll-target="#rubric">Rubric</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<script src="https://use.fontawesome.com/5235085b15.js"></script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Lab 2: Minnesota tree growth</h1>
<p class="subtitle lead">Manipulating and summarizing data with dplyr</p>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/minn-forest.jpg" class="img-fluid figure-img" width="1518"></p>
</figure>
</div>
</div>
</div>
<section id="intro-to-dplyr" class="level1">
<h1>Intro to <code>dplyr</code>:</h1>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
Attaching package: 'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
</div>
<p><code>dplyr</code> is an R package that provides a set of functions designed for data manipulation and transformation, making it easier to work with data frames (or tibbles). It is part of the tidyverse ecosystem and is widely used for data wrangling tasks such as filtering, selecting, summarizing, and mutating data.</p>
<section id="key-features-of-dplyr" class="level2">
<h2 class="anchored" data-anchor-id="key-features-of-dplyr">Key Features of dplyr</h2>
<ul>
<li>Pipe-friendly (%&gt;%/|&gt;) – Works seamlessly with the pipe operator from the magrittr package.</li>
<li>Efficient – Built on top of Rcpp for fast performance.</li>
<li>Consistent Grammar – Uses a consistent set of verbs for data manipulation.</li>
</ul>
<p>These verbs can be organized into three categories based on the component of the dataset upon which they (most commonly) operate:</p>
</section>
<section id="rows" class="level2">
<h2 class="anchored" data-anchor-id="rows">Rows:</h2>
<ul>
<li><code>filter()</code> subset rows based on column values.</li>
<li><code>slice()</code> subset rows based on index.</li>
<li><code>arrange()</code> change row order.</li>
</ul>
</section>
<section id="columns" class="level2">
<h2 class="anchored" data-anchor-id="columns">Columns:</h2>
<ul>
<li><code>select()</code> subset columns based on name or characteristics.</li>
<li><code>mutate()</code> change column values or create new columns.</li>
<li><code>rename()</code> change column name.</li>
</ul>
</section>
<section id="groups-of-rows" class="level2">
<h2 class="anchored" data-anchor-id="groups-of-rows">Groups of rows:</h2>
<ul>
<li><code>summarize()</code> collapse multiple rows into a single row.</li>
<li><code>n()</code>/<code>n_distint()</code> count group membership</li>
</ul>
</section>
<section id="glimpse" class="level2">
<h2 class="anchored" data-anchor-id="glimpse">Glimpse</h2>
<p><code>glimpse()</code> is a function from the <code>dplyr</code> package that provides a compact and easy-to-read summary of a data.frame. It is similar to <code>str()</code>, but with a more readable format. Its key features are that it:</p>
<ul>
<li>Displays the number of rows and columns.</li>
<li>Shows column names, types, and a preview of values.</li>
<li>Prints data in a transposed format (variables as rows instead of columns).</li>
</ul>
<p>We will use glimpse to report on our outputs in each question through this lab!</p>
</section>
<section id="piping" class="level2">
<h2 class="anchored" data-anchor-id="piping">Piping</h2>
<p>The pipe operator (|&gt;) in R is used to streamline code by passing the result of one function directly into the next function as the first argument. This makes code more readable and reduces the need for nested function calls.</p>
<section id="base-r-pipe-introduced-in-r-4.1.0-the-native-pipe-works-similarly-to-the-magrittr-pipe-but-is-built-into-base-r." class="level3">
<h3 class="anchored" data-anchor-id="base-r-pipe-introduced-in-r-4.1.0-the-native-pipe-works-similarly-to-the-magrittr-pipe-but-is-built-into-base-r.">Base R Pipe (|&gt;): Introduced in R 4.1.0, the native pipe (|&gt;) works similarly to the magrittr pipe (%&gt;%) but is built into base R.</h3>
<p><strong>Example 1: Without Pipe</strong> This code calculates the mean of a vector and rounds the result.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>), <span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
<p><strong>Example 2: Using native pipe |&gt; </strong></p>
<p>Here, the output of each function is passed to the next, making it easier to read.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mean</span>(<span class="at">na.rm =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span> </span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">round</span>(<span class="at">digits =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3</code></pre>
</div>
</div>
</section>
<section id="tidyverse-pipe" class="level3">
<h3 class="anchored" data-anchor-id="tidyverse-pipe">Tidyverse Pipe (%&gt;%)</h3>
<p>From the <code>magrittr</code> package (and used in <code>dplyr</code>), <code>%&gt;%</code> allows greater flexibility than <code>|&gt;</code>, such as:</p>
<ul>
<li>Using placeholders (.) when the first argument isn’t where the function expects input.</li>
<li>Automatically handling non-standard evaluation in dplyr.</li>
</ul>
<p><strong>Example 3: Using %&gt;% pipe</strong></p>
<p>This filters cars with mpg &gt; 20, selects relevant columns, and sorts them by mpg in descending order.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(mpg <span class="sc">&gt;</span> <span class="dv">20</span>) <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(mpg, cyl, hp) <span class="sc">%&gt;%</span></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mpg))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                mpg cyl  hp
Toyota Corolla 33.9   4  65
Fiat 128       32.4   4  66
Honda Civic    30.4   4  52
Lotus Europa   30.4   4 113
Fiat X1-9      27.3   4  66
Porsche 914-2  26.0   4  91
Merc 240D      24.4   4  62
Datsun 710     22.8   4  93
Merc 230       22.8   4  95
Toyota Corona  21.5   4  97
Hornet 4 Drive 21.4   6 110
Volvo 142E     21.4   4 109
Mazda RX4      21.0   6 110
Mazda RX4 Wag  21.0   6 110</code></pre>
</div>
</div>
</section>
<section id="key-differences" class="level3">
<h3 class="anchored" data-anchor-id="key-differences">Key Differences</h3>
<table class="caption-top table">
<colgroup>
<col style="width: 22%">
<col style="width: 32%">
<col style="width: 45%">
</colgroup>
<thead>
<tr class="header">
<th>Feature</th>
<th><code>|&gt;</code> (Base R)</th>
<th><code>%&gt;%</code> (Tidyverse)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Available in</td>
<td>R 4.1.0+ (no extra packages)</td>
<td>{magrittr} package</td>
</tr>
<tr class="even">
<td>First argument</td>
<td>Always passed as first argument</td>
<td>Can use . for flexibility</td>
</tr>
<tr class="odd">
<td>Function compatibility</td>
<td>Works with most functions</td>
<td>Works better with dplyr and NSE functions</td>
</tr>
</tbody>
</table>
<p>If you’re using tidyverse/dplyr, %&gt;% is still widely used. If you’re sticking to base R, |&gt; is the better choice.</p>
</section>
</section>
</section>
<section id="minnesota-tree-growth-data" class="level1">
<h1>Minnesota tree growth data:</h1>
<p>To start this lab, create a new Rproj with the proper structure (docs, images, data) and create a copy of this quarto file in it.</p>
<p>This lab is centered around exploring data manipulation with <code>dplyr</code> using a long term tree growth observation record from Minnisota. The Minnesota tree growth dataset can be found as part of the paper <a href="https://site.uvm.edu/tdamato/files/2021/05/Itter-et-al.-2017-EC-APPS.pdf">Variable effects of climate on forest growth in relation to climate extremes, disturbance, and forest dynamics</a>. As with most (good) papers, a data availability statement at the end of this paper tells us the data used in the study can be found on <a href="https://datadryad.org/stash/dataset/doi:10.5061/dryad.18pm5">Dyrad</a>. From the attached <code>README</code> we see the following data description:</p>
<p><code>tree_dat.csv</code> – Annual radial growth increments for individual trees.</p>
<p>Variables included in the tree data set are as follows. - <treeid>: unique tree identifier (total of 2,291 trees)<br>
- <standid>: unique stand identifier (total of 35 stands)<br>
- <stand>: alpha-numeric stand code<br>
- <year>: year of growth (study period equals 1897 to 2007)<br>
- <species>: species code (15 unique species, see below)<br>
ABBA: Abies balsamea<br>
ACRU: Acer rubrum<br>
ACSA: Acer saccharum<br>
BEPA: Betula papyrifera<br>
FRNI: Fraxinus nigra<br>
LALA: Larix laricina<br>
PIBA: Pinus banksiana<br>
PIGL: Picea glauca<br>
PIMA: Picea mariana<br>
PIRE: Pinus resinosa<br>
PIST: Pinus strobus<br>
POGR: Populus grandidentata<br>
POTR: Populus tremuloides<br>
QURU: Quercus rubra<br>
THOC: Thuja occidentalis<br>
- <age>: age of tree during year of growth<br>
- <inc>: linear growth increment (mm)<br>
- <rad_ib>: estimated inside bark radius of tree at breast height at the end of the year of grow (mm)<br>
</rad_ib></inc></age></species></year></stand></standid></treeid></p>
<p>Go to the above Dyrad site, and download this data sticking it into your data directory (unzipped).</p>
</section>
<section id="exercises" class="level1">
<h1>Exercises</h1>
<section id="filtering-rows" class="level2">
<h2 class="anchored" data-anchor-id="filtering-rows">1 Filtering rows</h2>
<p><code>filter()</code> creates row subsets that satisfy a condition involving values in one or more columns. The first argument in <code>filter()</code> is the <code>data.frame</code> from which you want to subset rows. Conditional statements passed as separate arguments are combined with the &amp; operator.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="images/02-filter.jpeg" class="img-fluid figure-img" width="2048"></p>
</figure>
</div>
</div>
</div>
<p>For this lab, you will read in the Minnesota tree growth dataset from the <code>trees_dat.csv</code> file found from Dyrad and saved to your <code>data</code> folder.</p>
<blockquote class="blockquote">
<p><strong>Question 1: Read in the Minnesota tree growth dataset. How many records are there in the dataset?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 2: How many trees are in stand 1?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 3: How many trees are of the Abies balsamea (<code>ABBA</code>) and Pinus strobus (<code>PIST</code>) species?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 4: From the above subset, how many are there of each ABBA and PIST?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 5: How many trees are older then 200 years old in the last year of the dataset?</strong></p>
</blockquote>
</section>
<section id="slicing-rows" class="level2">
<h2 class="anchored" data-anchor-id="slicing-rows">2. Slicing rows</h2>
<p>You can use the <code>slice()</code> family of functions to extract a chunk of your rows by their position in the dataset.</p>
<p>This function family includes:</p>
<p><code>slice(X:Y)</code>: filters out rows X to Y (where X and Y are numbers). <code>slice_max / slice_min</code> - filters for observations with the max/min values for a variable V. <code>slice_head</code>/<code>slice_tail</code> - return the first and last row of the given data.frame, respectively <code>slice_sample</code> - return a random subset of rows, with or without replacement, and with specified selection probability</p>
<p>Change the n argument in these functions to return more than one row (i.e., the default argument is n = 1), or use the prop argument to return the desired proportion of rows.</p>
<blockquote class="blockquote">
<p><strong>Question 6: What is the oldest tree in the dataset found using slice_max?</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 7: Using slice_max, find the oldest 5 trees, limit the query to those in year 2007. Use the help docs to understand optional parameters</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 8: Using slice_sample, how many trees are in a 30% sample?</strong></p>
</blockquote>
</section>
<section id="arranging-rows" class="level2">
<h2 class="anchored" data-anchor-id="arranging-rows">3 Arranging Rows</h2>
<p><code>arrange()</code> orders rows based on values in one or more columns. If you specify more than one column, each additional column is used to break ties in values of preceding columns. The default behavior is to sort column values in <strong>ascending</strong> order (i.e., smallest values at the top). If you want to sort column values in descending order, put the column name inside **desc(<em>)</em>.</p>
<p><code>arrange()</code> doesn’t change the number of rows, only their order. Row order doesn’t typically matter when analyzing data; however, order is often important for understanding and communicating data structure.</p>
<blockquote class="blockquote">
<p><strong>Question 9: Filter all trees in stand 5 in the maximum year. Sort this subset by <em>descending</em> radius at breast height (rad_ib) and use slice_head() to get the top three trees. Report the tree IDs</strong></p>
</blockquote>
</section>
<section id="reducing-columns" class="level2">
<h2 class="anchored" data-anchor-id="reducing-columns">4 Reducing Columns</h2>
<p>Another common task is to select a subset of columns in the dataset. This is accomplished using <code>select()</code>. &gt; <strong>Question 10: Reduce your full <code>data.frame</code> to [treeID, year, and radius at breast height]. Filter to only those in year 2007, and use slice to pull the top 3 rows.</strong></p>
<blockquote class="blockquote">
<p><strong>Question 11: Use select to <em>remove</em> the radius at breast height column</strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 12: Look at the help document for dplyr::select and examine the “Overview of selection features”. Identify an option (there are multiple) that would help select all columns with the string “ID” in the name.</strong></p>
</blockquote>
<p>The <code>&amp;</code> and <code>|</code> operators provide additional flexibility for specifying columns to retain or exclude. Use <code>&amp;</code> to identify the intersection between two column sets (i.e., those columns that are in both sets). Use <code>|</code> to identify the union of two column sets (i.e., all columns in at least one set).</p>
<blockquote class="blockquote">
<p><strong>Question 13: Find a selection pattern that captures all columns with either ‘ID’ or ‘stand’ in the name. Use a member of the slice family to return the last 3 rows. </strong></p>
</blockquote>
</section>
<section id="renaming-columns" class="level2">
<h2 class="anchored" data-anchor-id="renaming-columns">5. Renaming columns</h2>
<p>It’s easy to rename data.frame columns using rename(). The first argument in rename() is the data.frame containing columns to rename and subsequent arguments takes the form new_name = old_name.</p>
<blockquote class="blockquote">
<p>**Question 14: Looking back at the data dictionary, rename rad_inc and inc to include _{unit} in the name. Unlike earlier options, be sure that this renaming is permanent, and stays with your data.frame (e.g.&nbsp;<code>&lt;-</code>). Print the names of your new data.frame **</p>
</blockquote>
</section>
<section id="creating-new-columns" class="level2">
<h2 class="anchored" data-anchor-id="creating-new-columns">6 Creating new columns</h2>
<p><code>mutate()</code> creates new columns (or modifies existing ones) and adds them to the right side of an existing <code>data.frame</code>. The first argument in <code>mutate()</code> is the <code>data.frame</code> to be augmented and subsequent arguments define the new columns. This function is useful because exiting columns in the <code>data.frame</code> can be referenced when defining new columns.</p>
<p>Sometimes, we want a <code>data.frame</code> that includes only newly created columns, or a combination of original and new columns. In this case we use transmute(). For example, as illustrated in Figure 7.7, say we want to make ba using dbh in trees, but this time we want the new data.frame to include only the columns id, year, and ba (i.e., we don’t want to retain dbh). Also notice in Figure 7.7, we can carryover columns unchanged by just listing their names in transmute arguments.</p>
<blockquote class="blockquote">
<p><strong>Question 15: Looking back at the data dictionary, rename <code>rad_inc</code> and <code>inc</code> to include<code>_{unit}</code> in the name. Unlike earlier options, be sure that this renaming is permanent, and stays with your data.frame through reassignment (e.g.&nbsp;<code>&lt;-</code>). Print the names of your new data.frame </strong></p>
</blockquote>
<blockquote class="blockquote">
<p><strong>Question 16: A key measurement in forestry in “basal area column”. The metric is computed with the formula: <br> BA(m2) = 0.00007854⋅DBH^2 <br> Where DBH is the diameter at breast height (cm). Use mutate to compute both DBH in centimeters, and BA_m2. What is the mean BA_m2 of the the species <code>POTR</code> (in year 2007)</strong></p>
</blockquote>
</section>
<section id="case_when-if_esle" class="level2">
<h2 class="anchored" data-anchor-id="case_when-if_esle">7 case_when / if_esle</h2>
<p>case_when() is a function that provides a vectorized way to apply multiple conditional statements. It is commonly used for creating new variables based on conditions. Each condition is evaluated in order, and the first one that is TRUE determines the output. case_when() takes one or more arguments, where each argument, or case, is a two-sided formula where the left side is separated by the right side by a tilde symbol ~. The left side is a logical vector created using one or more vectors and logical operators in Section 4.7. The right side is the value to use when the left side is TRUE. If no cases are TRUE (i.e., none of the arguments’ left sides are TRUE) then a NA is returned. The <code>TRUE ~ default_result</code> at the end serves as a catch-all for any observation that does not meet a defined condition:</p>
<p>Syntax:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">case_when</span>(</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  condition1 <span class="sc">~</span> result1,</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  condition2 <span class="sc">~</span> result2,</span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  condition3 <span class="sc">~</span> result3,</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> default_result</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>In forestry, DBH_cm can be used to classify a tree using the following classification:</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>low</th>
<th>high</th>
<th>class</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>0</td>
<td>2.5</td>
<td>“seedling”</td>
</tr>
<tr class="even">
<td>2.5</td>
<td>10</td>
<td>“sapling”</td>
</tr>
<tr class="odd">
<td>10</td>
<td>30</td>
<td>“pole”</td>
</tr>
<tr class="even">
<td>30</td>
<td>-</td>
<td>“sawlog”</td>
</tr>
</tbody>
</table>
<blockquote class="blockquote">
<p><strong>Question 17: Use mutate and case_when to add a new column to you data.frame that classifies each tree into the proper DBH_class. Once done, limit your dataset to the year 2007 and report the number of each class with table. (Hint: table requires a vector input, not a data.frame)</strong></p>
</blockquote>
</section>
<section id="summarizing" class="level2">
<h2 class="anchored" data-anchor-id="summarizing">8. Summarizing</h2>
<p><code>summarize()</code> collapses a <code>data.frame</code> to a single row. We can use <code>summarize()</code> to compute summary statistics for one or more columns in a <code>data.frame</code>. The first argument in <code>summarize()</code> is the data.frame and subsequent arguments define how rows should be collapsed.</p>
<blockquote class="blockquote">
<p><strong>Question 18: Compute the mean DBH and standard deviation of DBH for all trees in 2007. Explain the values you found and their statistical meaning.</strong></p>
</blockquote>
<p><code>summarize()</code> is often the most useful when applied to groups of data (e.g species) rather then entire datasets!</p>
</section>
<section id="grouped-data" class="level2">
<h2 class="anchored" data-anchor-id="grouped-data">9 Grouped data</h2>
<p><code>group_by()</code> is used to group data by one or more variables. It is commonly used in conjunction with functions like <code>summarize()</code>, <code>mutate()</code>, or <code>filter()</code> to perform operations on subsets of data within a data.frame.</p>
<p>The first argument in <code>group_by()</code> is the d<code>ata.frame</code> to group and subsequent arguments identify the columns, or combination of columns, that define row membership to a group.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>trees_by_id <span class="ot">&lt;-</span> <span class="fu">group_by</span>(trees, treeID)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(trees_by_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>#&gt; Rows: 131,386 #&gt; Columns: 13 #&gt; Groups: treeID [2,291] #&gt; $ treeID <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… #&gt; $ standID <int> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1… #&gt; $ stand <chr> “A1”, “A1”, “A1”, “A1”, “A1”, “A1”, “A1”, “A1”, “A1”, “A1”, “A1”… #&gt; $ year <int> 1960, 1961, 1962, 1963, 1964, 1965, 1966, 1967, 1968, 1969, 1970…</int></chr></int></int></p>
<section id="how-do-dplyr-functions-behave-given-a-grouped-data.frame" class="level3">
<h3 class="anchored" data-anchor-id="how-do-dplyr-functions-behave-given-a-grouped-data.frame">How do <code>dplyr</code> functions behave given a grouped <code>data.frame</code>?</h3>
<p>If <code>filter()</code> is passed a grouped data.frame and the filtering condition uses a summary function or group characteristic (e.g., number of rows computed using the n()), the result will be group specific. Similarly, <code>slice()</code> and its various flavors subset rows within each group.Passing grouped and ungrouped data to <code>arrange()</code> gives the same result, unless you set the function’s optional argument <code>.by_group</code> to TRUE, in which case it will order first by the grouping. Recall, the functions select(), rename(), mutate(), transmute(), and relocate() operate on data.frame columns. Because <code>rename()</code> only affects the column name and position, its behavior is the same given grouped or ungrouped data. Similarly, a grouped select() is the same as an ungrouped select(), except grouping columns are always included in the resulting column subset. Similar to a grouped <code>filter()</code>, a grouped <code>mutate()</code> has different behavior if your new column definition uses a summary function or some other group specific characteristic (e.g.&nbsp;max/min/n()/lag/diff, etc.). As mentioned, <code>summarize()</code> is most useful when applied to grouped data. Given a grouped<code>data.frame</code>, column summaries requested from <code>summarize()</code> are applied to each group. Each time you apply <code>summarize()</code> to a grouped <code>data.frame</code>, the default behavior is to remove the last grouping level.</p>
<blockquote class="blockquote">
<p><strong>Question 19: Compute the <em>per species</em> mean tree age using only those ages recorded in 2003. Identify the three species with the oldest mean age.</strong></p>
</blockquote>
</section>
</section>
<section id="counting" class="level2">
<h2 class="anchored" data-anchor-id="counting">10 Counting</h2>
<p>We often need to know the number of rows, perhaps by group, within a dataset. Rows are counted using the <code>n()</code> helper function, which is a <em>context dependent function</em> used within <code>dplyr</code> verb functions. It takes no arguments and returns the context specific group size. We see <code>n()</code> used most often in <code>summarize()</code> and <code>mutate()</code> to count rows in groups.</p>
<p>The number of distinct values in a discrete variable is also often of interest (e.g., number of distinct plot numbers or species). <code>n_distinct()</code> returns the number of unique values in one or more variable. Like <code>n()</code>, when applied to a grouped <code>data.frame</code> within a verb function,<code>n_distinct()</code> returns the number of group specific distinct values:</p>
<blockquote class="blockquote">
<p><strong>Question 20: (1) Compute the number of unique years with records in the data set. (2) Determine the stands with the largest number of unique years recorded. Report all stands with largest (or tied wit the largest) temporal record. </strong></p>
</blockquote>
</section>
</section>
<section id="final-question" class="level1">
<h1>Final Question:</h1>
<p>We are interested in the annual DBH growth rate of each species through time, but we only want to include trees with at least a 10 year growth record. To identify this, we need to idnetify the per year growth made by each tree, there total growth record, and then average that, and compute the standard deviation, across the species.</p>
<blockquote class="blockquote">
<p>Use a combination of dplyr verbs to compute these values and report the 3 species with the fastest growth, and the 3 species with the slowest growth. (** You will need to use either <code>lag()</code> or <code>diff()</code> in your compuation. You can learn more about each in the Help pages)</p>
</blockquote>
<blockquote class="blockquote">
<p>Lastly, find and include an image of the fastest growing species. Add the image to your images directory.</p>
</blockquote>
</section>
<section id="rubric" class="level1">
<h1>Rubric</h1>
<ul class="task-list">
<li><label><input type="checkbox">Created as an R project with a proper project structure (data, images, docs) (5)</label></li>
<li><label><input type="checkbox">20 Questions @ 3 points each (60). Answered with code and full sentences.</label></li>
<li><label><input type="checkbox">Final Question (15)</label></li>
<li><label><input type="checkbox">Correct image with caption (5)</label></li>
<li><label><input type="checkbox">Connect your project to github and submit a URL of the rendered document (10)</label></li>
</ul>
<p><strong>Total</strong>: 100</p>


</section>

</main> <!-- /main -->
<script>
  Reveal.addEventListener( 'slidechanged', function( event ) {
    console.log("hello")
    
    slide_id = event.currentSlide.id
    link = "annotations" + ".html#" + slide_id
    
    var annotation_div = document.createElement('div')
    annotation_div.setAttribute("class", "annotation-link")
    
    var notes_link = document.createElement('a')
    notes_link.setAttribute("href", link)
    notes_link.setAttribute("target", "_blank")
    
    var iii = document.createElement('i')
    iii.setAttribute("class", "fa fa-info")
    notes_link.appendChild(iii)
    
    annotation_div.appendChild(notes_link)
    
    var tmp = event.currentTarget.getElementsByClassName("annotation-link")
    if (tmp.length === 1) {
      tmp[0].remove()
    }
    
    if (event.currentSlide.classList.contains("annotation")) {
      event.currentTarget.append(annotation_div)
    }
  } );

</script>
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleGiscusIfUsed = (isAlternate, darkModeDefault) => {
    const baseTheme = document.querySelector('#giscus-base-theme')?.value ?? 'light';
    const alternateTheme = document.querySelector('#giscus-alt-theme')?.value ?? 'dark';
    let newTheme = '';
    if(darkModeDefault) {
      newTheme = isAlternate ? baseTheme : alternateTheme;
    } else {
      newTheme = isAlternate ? alternateTheme : baseTheme;
    }
    const changeGiscusTheme = () => {
      // From: https://github.com/giscus/giscus/issues/336
      const sendMessage = (message) => {
        const iframe = document.querySelector('iframe.giscus-frame');
        if (!iframe) return;
        iframe.contentWindow.postMessage({ giscus: message }, 'https://giscus.app');
      }
      sendMessage({
        setConfig: {
          theme: newTheme
        }
      });
    }
    const isGiscussLoaded = window.document.querySelector('iframe.giscus-frame') !== null;
    if (isGiscussLoaded) {
      changeGiscusTheme();
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  const darkModeDefault = false;
  let localAlternateSentinel = darkModeDefault ? 'alternate' : 'default';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
    toggleGiscusIfUsed(toAlternate, darkModeDefault);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>