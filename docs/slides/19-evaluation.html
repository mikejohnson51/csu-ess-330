<!DOCTYPE html>
<html lang="en"><head>
<link href="../favicon.ico" rel="icon">
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-html/tabby.min.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/light-border.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <title>ESS 330 – Lecture 19</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="../site_libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      { color: #003b4f; background-color: #f1f3f5; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #003b4f; } /* Normal */
    code span.al { color: #ad0000; } /* Alert */
    code span.an { color: #5e5e5e; } /* Annotation */
    code span.at { color: #657422; } /* Attribute */
    code span.bn { color: #ad0000; } /* BaseN */
    code span.bu { } /* BuiltIn */
    code span.cf { color: #003b4f; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #20794d; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #5e5e5e; } /* Comment */
    code span.cv { color: #5e5e5e; font-style: italic; } /* CommentVar */
    code span.do { color: #5e5e5e; font-style: italic; } /* Documentation */
    code span.dt { color: #ad0000; } /* DataType */
    code span.dv { color: #ad0000; } /* DecVal */
    code span.er { color: #ad0000; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #ad0000; } /* Float */
    code span.fu { color: #4758ab; } /* Function */
    code span.im { color: #00769e; } /* Import */
    code span.in { color: #5e5e5e; } /* Information */
    code span.kw { color: #003b4f; font-weight: bold; } /* Keyword */
    code span.op { color: #5e5e5e; } /* Operator */
    code span.ot { color: #003b4f; } /* Other */
    code span.pp { color: #ad0000; } /* Preprocessor */
    code span.sc { color: #5e5e5e; } /* SpecialChar */
    code span.ss { color: #20794d; } /* SpecialString */
    code span.st { color: #20794d; } /* String */
    code span.va { color: #111111; } /* Variable */
    code span.vs { color: #20794d; } /* VerbatimString */
    code span.wa { color: #5e5e5e; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="../site_libs/revealjs/dist/theme/quarto-be8ed9a3cdcbe7a498a633334f8d1033.css">
  <link href="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="../site_libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
<script src="https://use.fontawesome.com/5235085b15.js"></script>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-color="#1E4D2B" class="quarto-title-block center">
  <h1 class="title">Lecture 19</h1>
  <p class="subtitle">Evaluation &amp; Tuning</p>

<div class="quarto-title-authors">
</div>

</section>
<section id="recaping-day-1---4" class="slide level2">
<h2>Recaping Day 1 - 4</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a></a><span class="fu">library</span>(tidymodels)</span>
<span id="cb1-2"><a></a><span class="fu">library</span>(forested)</span>
<span id="cb1-3"><a></a></span>
<span id="cb1-4"><a></a><span class="co"># Set a seed</span></span>
<span id="cb1-5"><a></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb1-6"><a></a></span>
<span id="cb1-7"><a></a><span class="co"># IntitalizeInitialize Split</span></span>
<span id="cb1-8"><a></a>forested_split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(forested, <span class="at">prop =</span> <span class="fl">0.8</span>)</span>
<span id="cb1-9"><a></a>forested_train <span class="ot">&lt;-</span> <span class="fu">training</span>(forested_split)</span>
<span id="cb1-10"><a></a>forested_test  <span class="ot">&lt;-</span> <span class="fu">testing</span>(forested_split)</span>
<span id="cb1-11"><a></a></span>
<span id="cb1-12"><a></a><span class="co"># Build Resamples</span></span>
<span id="cb1-13"><a></a>forested_folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(forested_train, <span class="at">v =</span> <span class="dv">10</span>)</span>
<span id="cb1-14"><a></a></span>
<span id="cb1-15"><a></a><span class="co"># Set a model specification with mode (default engine)</span></span>
<span id="cb1-16"><a></a>dt_mod         <span class="ot">&lt;-</span> <span class="fu">decision_tree</span>(<span class="at">cost_complexity =</span> <span class="fl">0.0001</span>, <span class="at">mode =</span> <span class="st">"classification"</span>)</span>
<span id="cb1-17"><a></a></span>
<span id="cb1-18"><a></a><span class="co"># Bare bones workflow &amp; fit</span></span>
<span id="cb1-19"><a></a>forested_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(forested <span class="sc">~</span> ., dt_mod)</span>
<span id="cb1-20"><a></a>forested_fit   <span class="ot">&lt;-</span> <span class="fu">fit</span>(forested_wflow, forested_train)</span>
<span id="cb1-21"><a></a></span>
<span id="cb1-22"><a></a><span class="co"># Extracting Predictions:</span></span>
<span id="cb1-23"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train)</span>
<span id="cb1-24"><a></a><span class="co">#&gt; # A tibble: 5,685 × 22</span></span>
<span id="cb1-25"><a></a><span class="co">#&gt;    .pred_class .pred_Yes .pred_No forested  year elevation eastness northness</span></span>
<span id="cb1-26"><a></a><span class="co">#&gt;    &lt;fct&gt;           &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span></span>
<span id="cb1-27"><a></a><span class="co">#&gt;  1 No             0.0114   0.989  No        2016       464       -5       -99</span></span>
<span id="cb1-28"><a></a><span class="co">#&gt;  2 Yes            0.636    0.364  Yes       2016       166       92        37</span></span>
<span id="cb1-29"><a></a><span class="co">#&gt;  3 No             0.0114   0.989  No        2016       644      -85       -52</span></span>
<span id="cb1-30"><a></a><span class="co">#&gt;  4 Yes            0.977    0.0226 Yes       2014      1285        4        99</span></span>
<span id="cb1-31"><a></a><span class="co">#&gt;  5 Yes            0.977    0.0226 Yes       2013       822       87        48</span></span>
<span id="cb1-32"><a></a><span class="co">#&gt;  6 Yes            0.808    0.192  Yes       2017         3        6       -99</span></span>
<span id="cb1-33"><a></a><span class="co">#&gt;  7 Yes            0.977    0.0226 Yes       2014      2041      -95        28</span></span>
<span id="cb1-34"><a></a><span class="co">#&gt;  8 Yes            0.977    0.0226 Yes       2015      1009       -8        99</span></span>
<span id="cb1-35"><a></a><span class="co">#&gt;  9 No             0.0114   0.989  No        2017       436      -98        19</span></span>
<span id="cb1-36"><a></a><span class="co">#&gt; 10 No             0.0114   0.989  No        2018       775       63        76</span></span>
<span id="cb1-37"><a></a><span class="co">#&gt; # ℹ 5,675 more rows</span></span>
<span id="cb1-38"><a></a><span class="co">#&gt; # ℹ 14 more variables: roughness &lt;dbl&gt;, tree_no_tree &lt;fct&gt;, dew_temp &lt;dbl&gt;,</span></span>
<span id="cb1-39"><a></a><span class="co">#&gt; #   precip_annual &lt;dbl&gt;, temp_annual_mean &lt;dbl&gt;, temp_annual_min &lt;dbl&gt;,</span></span>
<span id="cb1-40"><a></a><span class="co">#&gt; #   temp_annual_max &lt;dbl&gt;, temp_january_min &lt;dbl&gt;, vapor_min &lt;dbl&gt;,</span></span>
<span id="cb1-41"><a></a><span class="co">#&gt; #   vapor_max &lt;dbl&gt;, canopy_cover &lt;dbl&gt;, lon &lt;dbl&gt;, lat &lt;dbl&gt;, land_type &lt;fct&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="evaluation" class="slide level2">
<h2>Evaluation</h2>
<ul>
<li>So far we have used <code>metrics</code> and <code>collect_metrics</code> to evaluate and compare models</li>
<li>The default metrics for classification problems are: <code>accuracy</code>, <code>brier_score</code>, <code>roc_auc</code>
<ul>
<li>All classification metrics stem from the classic confusion matrix</li>
</ul></li>
</ul>
<div class="fragment">
<ul>
<li>The default metrics for regression problems are: <code>rsq</code>, <code>rmse</code>, <code>mae</code>
<ul>
<li>The majority of these are measures of correlation and residual error</li>
</ul></li>
</ul>
</div>
</section>
<section>
<section id="classification" class="title-slide slide level1 center">
<h1>Classification:</h1>

</section>
<section id="confusion-matrix" class="slide level2">
<h2>Confusion matrix <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>A confusion matrix is a table that describes the performance of a classification model on a set of data for which the true values are known.</li>
<li>It counts the number of accurate and false predictions, separated by the truth state</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb2-2"><a></a>  <span class="fu">conf_mat</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb2-3"><a></a><span class="co">#&gt;           Truth</span></span>
<span id="cb2-4"><a></a><span class="co">#&gt; Prediction  Yes   No</span></span>
<span id="cb2-5"><a></a><span class="co">#&gt;        Yes 2991  176</span></span>
<span id="cb2-6"><a></a><span class="co">#&gt;        No   144 2374</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="what-to-do-with-a-confusion-matrix" class="title-slide slide level1 center">
<h1>What to do with a confusion matrix</h1>

<img data-src="images/confusion-matrix.png" class="r-stretch"></section>
<section id="accuracy" class="slide level2">
<h2>1. Accuracy <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>Accuracy is the proportion of true results (both true positives and true negatives) among the total number of cases examined.</li>
<li>It is a measure of the correctness of the model’s predictions.</li>
<li>It is the most common metric used to evaluate classification models.</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="images/confusion-matrix-accuracy.png"></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb3-2"><a></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb3-3"><a></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb3-4"><a></a><span class="co">#&gt;   .metric  .estimator .estimate</span></span>
<span id="cb3-5"><a></a><span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb3-6"><a></a><span class="co">#&gt; 1 accuracy binary         0.944</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="sensitivity" class="slide level2">
<h2>2. Sensitivity <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>Sensitivity is the proportion of true positives to the sum of true positives and false negatives.</li>
<li>It is useful for identifying the presence of a condition.</li>
<li>It is also known as the true positive rate, recall, or probability of detection.</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="images/confusion-matrix-sensitivity.png"></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb4-2"><a></a>  <span class="fu">sensitivity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb4-3"><a></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb4-4"><a></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb4-5"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb4-6"><a></a><span class="co">#&gt; 1 sensitivity binary         0.954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="specificity" class="slide level2">
<h2>3. Specificity <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>Specificity is the proportion of true negatives to the sum of true negatives and false positives.</li>
<li>It is useful for identifying the absence of a condition.</li>
<li>It is also known as the true negative rate, and is the complement of sensitivity.</li>
</ul>
<div class="columns">
<div class="column" style="width:40%;">
<p><img data-src="images/confusion-matrix-specificity.png"></p>
</div><div class="column" style="width:60%;">
<div class="cell">
<div class="sourceCode cell-code" id="cb5" data-code-line-numbers="3-6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb5-2"><a></a>  <span class="fu">sensitivity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb5-3"><a></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb5-4"><a></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb5-5"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb5-6"><a></a><span class="co">#&gt; 1 sensitivity binary         0.954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb6-2"><a></a>  <span class="fu">specificity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb6-3"><a></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb6-4"><a></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb6-5"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb6-6"><a></a><span class="co">#&gt; 1 specificity binary         0.931</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="two-class-data" class="slide level2">
<h2>Two class data</h2>
<p>These metrics assume that we know the threshold for converting “soft” probability predictions into “hard” class predictions.</p>
<ul>
<li><p>For example, if the predicted probability of a tree is 0.7, we might say that the model predicts “Tree” for that observation.<br>
</p></li>
<li><p>If the predicted probability of a tree is 0.4, we might say that the model predicts “No tree” for that observation.<br>
</p></li>
<li><p>The threshold is the value that separates the two classes.<br>
</p></li>
<li><p>The default threshold is 0.5, but this can be changed.<br>
</p></li>
</ul>
<div class="fragment">
<p>Is a 50% threshold good?</p>
</div>
<div class="fragment">
<p>What happens if we say that we need to be 80% sure to declare an event?</p>
<ul>
<li>sensitivity ⬇️, specificity ⬆️</li>
</ul>
</div>
<div class="fragment">
<p>What happens for a 20% threshold?</p>
<ul>
<li>sensitivity ⬆️, specificity ⬇️</li>
</ul>
</div>
</section>
<section id="varying-the-threshold" class="slide level2">
<h2>Varying the threshold</h2>
<div class="columns">
<div class="column" style="width:50%;">
<ul>
<li>The threshold can be varied to see how it affects the sensitivity and specificity of the model.</li>
<li>This is done by plotting the sensitivity and specificity against the threshold.</li>
<li>The threshold is varied from 0 to 1, and the sensitivity and specificity are calculated at each threshold.</li>
<li>The plot shows the trade-off between sensitivity and specificity at different thresholds.</li>
<li>The threshold can be chosen based on the desired balance between sensitivity and specificity.</li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/thresholds-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="roc-curves" class="slide level2">
<h2>ROC curves</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>For an ROC (receiver operator characteristic) curve, we plot</p>
<ul>
<li>the false positive rate (1 - specificity) on the x-axis</li>
<li>the true positive rate (sensitivity) on the y-axis</li>
</ul>
<p>with sensitivity and specificity calculated at all possible thresholds.</p>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/roc-curve-1-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="roc-curves-1" class="slide level2">
<h2>ROC curves</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ROC AUC is the probability that a randomly chosen positive instance is ranked higher than a randomly chosen negative instance.</p>
<ul>
<li><p>The ROC AUC is a measure of how well the model separates the two classes.</p></li>
<li><p>The ROC AUC is a number between 0 and 1.</p></li>
<li><p>ROC AUC = 1 💯</p>
<ul>
<li>perfect classification</li>
</ul></li>
<li><p>ROC AUC = 0.5 😐</p>
<ul>
<li>random guessing</li>
</ul></li>
<li><p>ROC AUC &lt; 0.5 😱</p>
<ul>
<li>worse than random guessing</li>
</ul></li>
</ul>
</div><div class="column" style="width:50%;">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/roc-curve-2-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="roc-curves-2" class="slide level2">
<h2>ROC curves <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>(A ROC AUC of 0.7-0.8 is considered acceptable, 0.8-0.9 is good, and &gt;0.9 is excellent.)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a></a><span class="co"># Assumes _first_ factor level is event; there are options to change that</span></span>
<span id="cb7-2"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span>  </span>
<span id="cb7-3"><a></a>  <span class="fu">roc_curve</span>(<span class="at">truth =</span> forested, .pred_Yes)  <span class="sc">|&gt;</span> </span>
<span id="cb7-4"><a></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>, <span class="dv">20</span>, <span class="dv">50</span>)</span>
<span id="cb7-5"><a></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb7-6"><a></a><span class="co">#&gt;   .threshold specificity sensitivity</span></span>
<span id="cb7-7"><a></a><span class="co">#&gt;        &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt;</span></span>
<span id="cb7-8"><a></a><span class="co">#&gt; 1   -Inf           0           1    </span></span>
<span id="cb7-9"><a></a><span class="co">#&gt; 2      0.235       0.885       0.972</span></span>
<span id="cb7-10"><a></a><span class="co">#&gt; 3      0.909       0.969       0.826</span></span>
<span id="cb7-11"><a></a></span>
<span id="cb7-12"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span>  </span>
<span id="cb7-13"><a></a>  <span class="fu">roc_auc</span>(<span class="at">truth =</span> forested, .pred_Yes)</span>
<span id="cb7-14"><a></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb7-15"><a></a><span class="co">#&gt;   .metric .estimator .estimate</span></span>
<span id="cb7-16"><a></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb7-17"><a></a><span class="co">#&gt; 1 roc_auc binary         0.975</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="brier-score" class="slide level2">
<h2>Brier score</h2>
<ul>
<li><p>The Brier score is a measure of how well the predicted probabilities of an event match the actual outcomes.</p></li>
<li><p>It is the mean squared difference between predicted probabilities and actual outcomes.</p></li>
<li><p>The Brier score is a number between 0 and 1.</p></li>
<li><p>The Brier score is analogous to the mean squared error in regression models:</p></li>
<li><p>Brier = 1 😱</p>
<ul>
<li>predicted probabilities are completely wrong</li>
</ul></li>
<li><p>Brier = 0.5 😐</p>
<ul>
<li>bad</li>
</ul></li>
<li><p>Brier &lt; 0.25</p>
<ul>
<li>acceptable</li>
</ul></li>
<li><p>Brier = 0 💯</p>
<ul>
<li>predicted probabilities are perfect</li>
</ul></li>
</ul>
<p><span class="math display">\[
Brier_{class} = \frac{1}{N}\sum_{i=1}^N\sum_{k=1}^C (y_{ik} - \hat{p}_{ik})^2
\]</span></p>
</section>
<section id="brier-score-1" class="slide level2">
<h2>Brier score</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span>  </span>
<span id="cb8-2"><a></a>  <span class="fu">brier_class</span>(<span class="at">truth =</span> forested, .pred_Yes) </span>
<span id="cb8-3"><a></a><span class="co">#&gt; # A tibble: 1 × 3</span></span>
<span id="cb8-4"><a></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb8-5"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb8-6"><a></a><span class="co">#&gt; 1 brier_class binary        0.0469</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="separation-vs-calibration" class="slide level2">
<h2>Separation vs calibration</h2>
<div class="columns">
<div class="column" style="width:50%;">
<p>The ROC captures separation. - The ROC curve shows the trade-off between sensitivity and specificity at different thresholds.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/separation-forested-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div><div class="column" style="width:50%;">
<p>The Brier score captures calibration. - The Brier score is a measure of how well the predicted probabilities of an event match the actual outcomes.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/calibration-forested-1.png" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
</div></div>
<ul>
<li>Good separation: the densities don’t overlap.</li>
<li>Good calibration: the calibration line follows the diagonal.</li>
</ul>
<p>Calibration plot: We bin observations according to predicted probability. In the bin for 20%-30% predicted prob, we should see an event rate of ~25% if the model is well-calibrated.</p>
</section></section>
<section>
<section id="regression" class="title-slide slide level1 center">
<h1>Regression</h1>

</section>
<section id="r-squared-r2" class="slide level2">
<h2>R-squared (<span class="math inline">\(R^2\)</span>)</h2>
<ul>
<li>Measures how well the model explains the variance in the data.</li>
<li>Formula:</li>
</ul>
<p><span class="math display">\[
R^2 = 1 - \frac{SS_{res}}{SS_{tot}}
\]</span> where:<br>
- <span class="math inline">\(SS_{res}\)</span> is the sum of squared residuals.<br>
</p>
<ul>
<li><p><span class="math inline">\(SS_{tot}\)</span> is the total sum of squares.<br>
</p></li>
<li><p>Values range from <span class="math inline">\(-\infty\)</span> to 1.<br>
</p>
<ul>
<li>1: Perfect fit<br>
</li>
<li>0: No improvement over mean prediction<br>
</li>
<li>Negative: Worse than just using the mean<br>
</li>
</ul></li>
</ul>
</section>
<section id="root-mean-squared-error-rmse" class="slide level2">
<h2>Root Mean Squared Error (RMSE)</h2>
<ul>
<li>Measures the model’s prediction error in the same unit as the dependent variable.</li>
<li>Formula:</li>
</ul>
<p><span class="math display">\[
RMSE = \sqrt{\frac{1}{n} \sum_{i=1}^{n} (y_i - \hat{y}_i)^2}
\]</span></p>
<p>where: - <span class="math inline">\(y_i\)</span> is the actual value. - <span class="math inline">\(\hat{y}_i\)</span> is the predicted value.</p>
<ul>
<li>Penalizes large errors more than MAE.</li>
<li>Lower RMSE indicates better model performance.</li>
</ul>
</section>
<section id="mean-absolute-error-mae" class="slide level2">
<h2>Mean Absolute Error (MAE)</h2>
<ul>
<li>Measures average absolute errors between predictions and actual values.</li>
<li>Formula:</li>
</ul>
<p><span class="math display">\[
MAE = \frac{1}{n} \sum_{i=1}^{n} |y_i - \hat{y}_i|
\]</span></p>
<ul>
<li>Less sensitive to outliers than RMSE.</li>
<li>Lower MAE indicates better model performance.</li>
</ul>
</section>
<section id="comparing-metrics" class="slide level2">
<h2>Comparing Metrics</h2>
<table class="caption-top">
<thead>
<tr class="header">
<th>Metric</th>
<th>Interpretation</th>
<th>Sensitivity to Outliers</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math inline">\(R^2\)</span></td>
<td>Variance explained</td>
<td>Moderate</td>
</tr>
<tr class="even">
<td>RMSE</td>
<td>Penalizes large errors more</td>
<td>High</td>
</tr>
<tr class="odd">
<td>MAE</td>
<td>Average error size</td>
<td>Low</td>
</tr>
</tbody>
</table>
<p><br></p>
<h4 id="choosing-the-right-metric">Choosing the Right Metric</h4>
<ul>
<li><strong>Use <span class="math inline">\(R^2\)</span></strong> to assess model fit and explainability.</li>
<li><strong>Use RMSE</strong> if large errors are especially undesirable.</li>
<li><strong>Use MAE</strong> for a more interpretable, robust metric.</li>
</ul>
</section>
<section id="section" class="slide level2" data-background-iframe="https://yardstick.tidymodels.org/reference/index.html">
<h2></h2>
<div class="footer">

</div>
</section>
<section id="metrics-selection-model-performance" class="slide level2">
<h2>Metrics Selection model performance <img data-src="hexes/yardstick.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>We can use <code>metric_set()</code> to combine multiple calculations into one</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a></a>forested_metrics <span class="ot">&lt;-</span> <span class="fu">metric_set</span>(accuracy, specificity, sensitivity)</span>
<span id="cb9-2"><a></a></span>
<span id="cb9-3"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb9-4"><a></a>  <span class="fu">forested_metrics</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb9-5"><a></a><span class="co">#&gt; # A tibble: 3 × 3</span></span>
<span id="cb9-6"><a></a><span class="co">#&gt;   .metric     .estimator .estimate</span></span>
<span id="cb9-7"><a></a><span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb9-8"><a></a><span class="co">#&gt; 1 accuracy    binary         0.944</span></span>
<span id="cb9-9"><a></a><span class="co">#&gt; 2 specificity binary         0.931</span></span>
<span id="cb9-10"><a></a><span class="co">#&gt; 3 sensitivity binary         0.954</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Metrics and metric sets work with grouped data frames!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb10-2"><a></a>  <span class="fu">group_by</span>(tree_no_tree) <span class="sc">|&gt;</span></span>
<span id="cb10-3"><a></a>  <span class="fu">accuracy</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb10-4"><a></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb10-5"><a></a><span class="co">#&gt;   tree_no_tree .metric  .estimator .estimate</span></span>
<span id="cb10-6"><a></a><span class="co">#&gt;   &lt;fct&gt;        &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb10-7"><a></a><span class="co">#&gt; 1 Tree         accuracy binary         0.946</span></span>
<span id="cb10-8"><a></a><span class="co">#&gt; 2 No tree      accuracy binary         0.941</span></span>
<span id="cb10-9"><a></a></span>
<span id="cb10-10"><a></a><span class="fu">augment</span>(forested_fit, <span class="at">new_data =</span> forested_train) <span class="sc">|&gt;</span></span>
<span id="cb10-11"><a></a>  <span class="fu">group_by</span>(tree_no_tree) <span class="sc">|&gt;</span></span>
<span id="cb10-12"><a></a>  <span class="fu">specificity</span>(<span class="at">truth =</span> forested, <span class="at">estimate =</span> .pred_class)</span>
<span id="cb10-13"><a></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb10-14"><a></a><span class="co">#&gt;   tree_no_tree .metric     .estimator .estimate</span></span>
<span id="cb10-15"><a></a><span class="co">#&gt;   &lt;fct&gt;        &lt;chr&gt;       &lt;chr&gt;          &lt;dbl&gt;</span></span>
<span id="cb10-16"><a></a><span class="co">#&gt; 1 Tree         specificity binary         0.582</span></span>
<span id="cb10-17"><a></a><span class="co">#&gt; 2 No tree      specificity binary         0.974</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-note callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Note</strong></p>
</div>
<div class="callout-content">
<p>The specificity for <code>"Tree"</code> is a good bit lower than it is for <code>"No tree"</code>.</p>
<p>So, when this index classifies the plot as having a tree, the model does not do well at correctly identifying the plot as non-forested when it is indeed non-forested.</p>
</div>
</div>
</div>
</div>
</section></section>
<section>
<section id="recap" class="title-slide slide level1 center">
<h1>Recap</h1>

</section>
<section id="previously---setup" class="slide level2">
<h2>Previously - Setup <img data-src="hexes/tidymodels.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb11-2"><a></a><span class="co"># Ingest Data</span></span>
<span id="cb11-3"><a></a><span class="co"># URLs for COVID-19 case data and census population data</span></span>
<span id="cb11-4"><a></a>covid_url <span class="ot">&lt;-</span> <span class="st">'https://raw.githubusercontent.com/nytimes/covid-19-data/master/us-states.csv'</span></span>
<span id="cb11-5"><a></a>pop_url <span class="ot">&lt;-</span>  <span class="st">'/Users/mikejohnson/Downloads/co-est2023-alldata.csv'</span></span>
<span id="cb11-6"><a></a><span class="co">#pop_url   &lt;- 'https://www2.census.gov/programs-surveys/popest/datasets/2020-2023/counties/totals/co-est2023-alldata.csv'</span></span>
<span id="cb11-7"><a></a></span>
<span id="cb11-8"><a></a><span class="co"># Clean Census Data</span></span>
<span id="cb11-9"><a></a>census <span class="ot">=</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(pop_url)  <span class="sc">|&gt;</span> </span>
<span id="cb11-10"><a></a>  <span class="fu">filter</span>(COUNTY <span class="sc">==</span> <span class="st">"000"</span>) <span class="sc">|&gt;</span>  <span class="co"># Filter for state-level data only</span></span>
<span id="cb11-11"><a></a>  <span class="fu">mutate</span>(<span class="at">fips =</span> STATE) <span class="sc">|&gt;</span>      <span class="co"># Create a new FIPS column for merging</span></span>
<span id="cb11-12"><a></a>  <span class="fu">select</span>(fips, <span class="fu">contains</span>(<span class="st">"2021"</span>))  <span class="co"># Select relevant columns for 2021 data</span></span>
<span id="cb11-13"><a></a></span>
<span id="cb11-14"><a></a><span class="co"># Process COVID-19 Data</span></span>
<span id="cb11-15"><a></a>state_data <span class="ot">&lt;-</span>  readr<span class="sc">::</span><span class="fu">read_csv</span>(covid_url) <span class="sc">|&gt;</span> </span>
<span id="cb11-16"><a></a>  <span class="fu">group_by</span>(fips) <span class="sc">|&gt;</span> </span>
<span id="cb11-17"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-18"><a></a>    <span class="at">new_cases  =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, cases  <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(cases)),   <span class="co"># Compute new cases, ensuring no negative values</span></span>
<span id="cb11-19"><a></a>    <span class="at">new_deaths =</span> <span class="fu">pmax</span>(<span class="dv">0</span>, deaths <span class="sc">-</span> dplyr<span class="sc">::</span><span class="fu">lag</span>(deaths))  <span class="co"># Compute new deaths, ensuring no negative values</span></span>
<span id="cb11-20"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-21"><a></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-22"><a></a>  <span class="fu">left_join</span>(census, <span class="at">by =</span> <span class="st">"fips"</span>) <span class="sc">|&gt;</span>  <span class="co"># Merge with census data</span></span>
<span id="cb11-23"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-24"><a></a>    <span class="at">m =</span> <span class="fu">month</span>(date), <span class="at">y =</span> <span class="fu">year</span>(date),</span>
<span id="cb11-25"><a></a>    <span class="at">season =</span> <span class="fu">case_when</span>(   <span class="co"># Define seasons based on month</span></span>
<span id="cb11-26"><a></a>      m <span class="sc">%in%</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">~</span> <span class="st">"Spring"</span>,</span>
<span id="cb11-27"><a></a>      m <span class="sc">%in%</span> <span class="dv">6</span><span class="sc">:</span><span class="dv">8</span> <span class="sc">~</span> <span class="st">"Summer"</span>,</span>
<span id="cb11-28"><a></a>      m <span class="sc">%in%</span> <span class="dv">9</span><span class="sc">:</span><span class="dv">11</span> <span class="sc">~</span> <span class="st">"Fall"</span>,</span>
<span id="cb11-29"><a></a>      m <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">2</span>) <span class="sc">~</span> <span class="st">"Winter"</span></span>
<span id="cb11-30"><a></a>    )</span>
<span id="cb11-31"><a></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb11-32"><a></a>  <span class="fu">group_by</span>(state, y, season) <span class="sc">|&gt;</span> </span>
<span id="cb11-33"><a></a>  <span class="fu">mutate</span>(</span>
<span id="cb11-34"><a></a>    <span class="at">season_cases  =</span> <span class="fu">sum</span>(new_cases, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Aggregate seasonal cases</span></span>
<span id="cb11-35"><a></a>    <span class="at">season_deaths =</span> <span class="fu">sum</span>(new_deaths, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)  <span class="co"># Aggregate seasonal deaths</span></span>
<span id="cb11-36"><a></a>  )  <span class="sc">|&gt;</span> </span>
<span id="cb11-37"><a></a>  <span class="fu">distinct</span>(state, y, season, <span class="at">.keep_all =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span>  <span class="co"># Keep only distinct rows by state, year, season</span></span>
<span id="cb11-38"><a></a>  <span class="fu">ungroup</span>() <span class="sc">|&gt;</span> </span>
<span id="cb11-39"><a></a>  <span class="fu">select</span>(state, <span class="fu">contains</span>(<span class="st">'season'</span>), y, POPESTIMATE2021, BIRTHS2021, DEATHS2021) <span class="sc">|&gt;</span>  <span class="co"># Select relevant columns</span></span>
<span id="cb11-40"><a></a>  <span class="fu">drop_na</span>() <span class="sc">|&gt;</span>  <span class="co"># Remove rows with missing values</span></span>
<span id="cb11-41"><a></a>  <span class="fu">mutate</span>(<span class="at">logC =</span> <span class="fu">log</span>(season_cases <span class="sc">+</span><span class="dv">1</span>))  <span class="co"># Log-transform case numbers for modeling</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="previously---data-usage" class="slide level2">
<h2>Previously - Data Usage <img data-src="hexes/rsample.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a></a><span class="fu">set.seed</span>(<span class="dv">4028</span>)</span>
<span id="cb12-2"><a></a>split <span class="ot">&lt;-</span> <span class="fu">initial_split</span>(state_data, <span class="at">prop =</span> <span class="fl">0.8</span>, <span class="at">strata =</span> season)  <span class="co"># 80/20 train-test split</span></span>
<span id="cb12-3"><a></a>train <span class="ot">&lt;-</span> <span class="fu">training</span>(split)  <span class="co"># Training set</span></span>
<span id="cb12-4"><a></a>test <span class="ot">&lt;-</span> <span class="fu">testing</span>(split)  <span class="co"># Test set</span></span>
<span id="cb12-5"><a></a></span>
<span id="cb12-6"><a></a><span class="fu">set.seed</span>(<span class="dv">3045</span>)</span>
<span id="cb12-7"><a></a>folds <span class="ot">&lt;-</span> <span class="fu">vfold_cv</span>(train, <span class="at">v =</span> <span class="dv">10</span>)  <span class="co"># 10-fold cross-validation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="previously---feature-engineering" class="slide level2">
<h2>Previously - Feature engineering <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a></a>rec <span class="ot">=</span> <span class="fu">recipe</span>(logC <span class="sc">~</span> . , <span class="at">data =</span> train) <span class="sc">|&gt;</span> </span>
<span id="cb13-2"><a></a>  <span class="fu">step_rm</span>(state, season_cases) <span class="sc">|&gt;</span>  <span class="co"># Remove non-predictive columns</span></span>
<span id="cb13-3"><a></a>  <span class="fu">step_dummy</span>(<span class="fu">all_nominal</span>()) <span class="sc">|&gt;</span>  <span class="co"># Convert categorical variables to dummy variables</span></span>
<span id="cb13-4"><a></a>  <span class="fu">step_scale</span>(<span class="fu">all_numeric_predictors</span>()) <span class="sc">|&gt;</span>  <span class="co"># Scale numeric predictors</span></span>
<span id="cb13-5"><a></a>  <span class="fu">step_center</span>(<span class="fu">all_numeric_predictors</span>())  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section></section>
<section>
<section id="optimizing-models-via-tuning-hyperparameter" class="title-slide slide level1 center">
<h1>Optimizing Models via Tuning Hyperparameter</h1>

</section>
<section id="tuning-parameters" class="slide level2">
<h2>Tuning parameters</h2>
<ul>
<li><p>Some model or preprocessing parameters cannot be estimated directly from the data.</p></li>
<li><p>Try different values and measure their performance.</p></li>
</ul>
<div class="fragment">
<ul>
<li>Find good values for these parameters.</li>
</ul>
</div>
<div class="fragment">
<ul>
<li>Once the value(s) of the parameter(s) are determined, a model can be finalized by fitting the model to the entire training set.</li>
</ul>
</div>
</section>
<section id="tagging-parameters-for-tuning" class="slide level2">
<h2>Tagging parameters for tuning <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>With tidymodels, you can mark the parameters that you want to optimize with a value of <code>tune()</code>.</p>
<p><br></p>
<p>The function itself just returns… itself:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a></a><span class="fu">tune</span>()</span>
<span id="cb14-2"><a></a><span class="co">#&gt; tune()</span></span>
<span id="cb14-3"><a></a></span>
<span id="cb14-4"><a></a><span class="fu">str</span>(<span class="fu">tune</span>())</span>
<span id="cb14-5"><a></a><span class="co">#&gt;  language tune()</span></span>
<span id="cb14-6"><a></a></span>
<span id="cb14-7"><a></a><span class="co"># optionally add a label</span></span>
<span id="cb14-8"><a></a><span class="fu">tune</span>(<span class="st">"Marker"</span>)</span>
<span id="cb14-9"><a></a><span class="co">#&gt; tune("Marker")</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="boosted-trees" class="slide level2">
<h2>Boosted Trees</h2>
<p>In last weeks live demo, a boosted tree proved most effective.</p>
<p>Boosted Trees are popular ensemble methods that build a <em>sequence</em> of tree models.</p>
<p>Each tree uses the results of the previous tree to better predict samples, especially those that have been poorly predicted.</p>
<p>Each tree in the ensemble is saved and new samples are predicted using a weighted average of the votes of each tree in the ensemble.</p>
</section>
<section id="boosted-tree-tuning-parameters" class="slide level2">
<h2>Boosted Tree Tuning Parameters</h2>
<p>Some <em>possible</em> parameters:</p>
<ul>
<li><code>mtry</code>: The number of predictors randomly sampled at each split (in <span class="math inline">\([1, ncol(x)]\)</span> or <span class="math inline">\((0, 1]\)</span>).</li>
<li><code>trees</code>: The number of trees (<span class="math inline">\([1, \infty]\)</span>, but usually up to thousands)</li>
<li><code>min_n</code>: The number of samples needed to further split (<span class="math inline">\([1, n]\)</span>).</li>
<li><code>learn_rate</code>: The rate that each tree adapts from previous iterations (<span class="math inline">\((0, \infty]\)</span>, usual maximum is 0.1).</li>
<li><code>stop_iter</code>: The number of iterations of boosting where <em>no improvement</em> was shown before stopping (<span class="math inline">\([1, trees]\)</span>)</li>
</ul>
</section>
<section id="boosted-tree-tuning-parameters-1" class="slide level2">
<h2>Boosted Tree Tuning Parameters <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a></a>b_mod <span class="ot">&lt;-</span> </span>
<span id="cb15-2"><a></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb15-3"><a></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb15-4"><a></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb15-5"><a></a></span>
<span id="cb15-6"><a></a>(b_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(rec, b_mod))</span>
<span id="cb15-7"><a></a><span class="co">#&gt; ══ Workflow ════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════════</span></span>
<span id="cb15-8"><a></a><span class="co">#&gt; Preprocessor: Recipe</span></span>
<span id="cb15-9"><a></a><span class="co">#&gt; Model: boost_tree()</span></span>
<span id="cb15-10"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-11"><a></a><span class="co">#&gt; ── Preprocessor ────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb15-12"><a></a><span class="co">#&gt; 4 Recipe Steps</span></span>
<span id="cb15-13"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-14"><a></a><span class="co">#&gt; • step_rm()</span></span>
<span id="cb15-15"><a></a><span class="co">#&gt; • step_dummy()</span></span>
<span id="cb15-16"><a></a><span class="co">#&gt; • step_scale()</span></span>
<span id="cb15-17"><a></a><span class="co">#&gt; • step_center()</span></span>
<span id="cb15-18"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-19"><a></a><span class="co">#&gt; ── Model ───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────</span></span>
<span id="cb15-20"><a></a><span class="co">#&gt; Boosted Tree Model Specification (regression)</span></span>
<span id="cb15-21"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-22"><a></a><span class="co">#&gt; Main Arguments:</span></span>
<span id="cb15-23"><a></a><span class="co">#&gt;   trees = tune()</span></span>
<span id="cb15-24"><a></a><span class="co">#&gt;   learn_rate = tune()</span></span>
<span id="cb15-25"><a></a><span class="co">#&gt; </span></span>
<span id="cb15-26"><a></a><span class="co">#&gt; Computational engine: xgboost</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="optimize-tuning-parameters" class="slide level2">
<h2>Optimize tuning parameters</h2>
<p>The main two strategies for optimization are:</p>
<div class="fragment">
<ul>
<li><p><strong>Grid search</strong> 💠 which tests a pre-defined set of candidate values</p></li>
<li><p><strong>Iterative search</strong> 🌀 which suggests/estimates new values of candidate parameters to evaluate</p></li>
</ul>
</div>
</section>
<section id="grid-search" class="slide level2">
<h2>1. Grid search</h2>
<ul>
<li><p>Most basic (but very effective) way to tune models</p></li>
<li><p>A small grid of points trying to minimize the error via learning rate:</p></li>
</ul>

<img data-src="images/small_init.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"></section>
<section id="grid-search-1" class="slide level2">
<h2>1. Grid search</h2>
<p>In reality we would probably sample the space more densely:</p>

<img data-src="images/grid_points.svg" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"></section>
<section id="iterative-search" class="slide level2">
<h2>2. Iterative Search</h2>
<p>We could start with a few points and search the space:</p>

<img data-src="images/anime_seq.gif" class="quarto-figure quarto-figure-center r-stretch" style="width:60.0%"></section></section>
<section>
<section id="grid-search-example" class="title-slide slide level1 center">
<h1>Grid Search Example</h1>

</section>
<section id="parameters" class="slide level2">
<h2>Parameters</h2>
<ul>
<li><p>The tidymodels framework provides pre-defined information on tuning parameters (such as their type, range, transformations, etc).</p></li>
<li><p>The <code>extract_parameter_set_dials()</code> function extracts these tuning parameters and the info.</p></li>
</ul>
<h4 id="grids">Grids</h4>
<ul>
<li><p>Create your grid manually or automatically.</p></li>
<li><p>The <code>grid_*()</code> functions can make a grid.</p></li>
</ul>
</section>
<section id="different-types-of-grids" class="slide level2">
<h2>Different types of grids <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell" data-layout-align="center">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/grid-types-1.png" class="quarto-figure quarto-figure-center" style="width:100.0%"></p>
</figure>
</div>
</div>
</div>
<p>Space-filling designs (SFD) attempt to cover the parameter space without redundant candidates. We recommend these the most.</p>
</section>
<section id="create-a-grid" class="slide level2">
<h2>Create a grid <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a></a><span class="co"># Extac</span></span>
<span id="cb16-2"><a></a>(b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a></a>  <span class="fu">extract_parameter_set_dials</span>())</span>
<span id="cb16-4"><a></a></span>
<span id="cb16-5"><a></a><span class="co"># Individual functions: </span></span>
<span id="cb16-6"><a></a>(<span class="fu">trees</span>())</span>
<span id="cb16-7"><a></a>(<span class="fu">learn_rate</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>A parameter set can be updated (e.g.&nbsp;to change the ranges).</p>
</div>
</section>
<section id="create-a-grid-1" class="slide level2">
<h2>Create a grid <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<ul>
<li>The <code>grid_*()</code> functions create a grid of parameter values to evaluate.</li>
<li>The <code>grid_space_filling()</code> function creates a space-filling design (SFD) of parameter values to evaluate.</li>
<li>The <code>grid_regular()</code> function creates a regular grid of parameter values to evaluate.</li>
<li>The <code>grid_random()</code> function creates a random grid of parameter values to evaluate.</li>
<li>The <code>grid_latin_hypercube()</code> function creates a Latin hypercube design of parameter values to evaluate.</li>
<li>The <code>grid_max_entropy()</code> function creates a maximum entropy design of parameter values to evaluate.</li>
</ul>
</section>
<section id="create-a-sfd-curve" class="slide level2">
<h2>Create a SFD curve <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb17" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb17-2"><a></a></span>
<span id="cb17-3"><a></a>(grid <span class="ot">&lt;-</span> </span>
<span id="cb17-4"><a></a>  b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb17-5"><a></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span> </span>
<span id="cb17-6"><a></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb17-7"><a></a><span class="co">#&gt; # A tibble: 25 × 2</span></span>
<span id="cb17-8"><a></a><span class="co">#&gt;    trees learn_rate</span></span>
<span id="cb17-9"><a></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb17-10"><a></a><span class="co">#&gt;  1     1    0.0287 </span></span>
<span id="cb17-11"><a></a><span class="co">#&gt;  2    84    0.00536</span></span>
<span id="cb17-12"><a></a><span class="co">#&gt;  3   167    0.121  </span></span>
<span id="cb17-13"><a></a><span class="co">#&gt;  4   250    0.00162</span></span>
<span id="cb17-14"><a></a><span class="co">#&gt;  5   334    0.0140 </span></span>
<span id="cb17-15"><a></a><span class="co">#&gt;  6   417    0.0464 </span></span>
<span id="cb17-16"><a></a><span class="co">#&gt;  7   500    0.196  </span></span>
<span id="cb17-17"><a></a><span class="co">#&gt;  8   584    0.00422</span></span>
<span id="cb17-18"><a></a><span class="co">#&gt;  9   667    0.00127</span></span>
<span id="cb17-19"><a></a><span class="co">#&gt; 10   750    0.0178 </span></span>
<span id="cb17-20"><a></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="create-a-regular-grid" class="slide level2">
<h2>Create a regular grid <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a></a><span class="fu">set.seed</span>(<span class="dv">12</span>)</span>
<span id="cb18-2"><a></a></span>
<span id="cb18-3"><a></a>(grid <span class="ot">&lt;-</span> </span>
<span id="cb18-4"><a></a>  b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb18-5"><a></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span> </span>
<span id="cb18-6"><a></a>  <span class="fu">grid_regular</span>(<span class="at">levels =</span> <span class="dv">4</span>))</span>
<span id="cb18-7"><a></a><span class="co">#&gt; # A tibble: 16 × 2</span></span>
<span id="cb18-8"><a></a><span class="co">#&gt;    trees learn_rate</span></span>
<span id="cb18-9"><a></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb18-10"><a></a><span class="co">#&gt;  1     1    0.001  </span></span>
<span id="cb18-11"><a></a><span class="co">#&gt;  2   667    0.001  </span></span>
<span id="cb18-12"><a></a><span class="co">#&gt;  3  1333    0.001  </span></span>
<span id="cb18-13"><a></a><span class="co">#&gt;  4  2000    0.001  </span></span>
<span id="cb18-14"><a></a><span class="co">#&gt;  5     1    0.00681</span></span>
<span id="cb18-15"><a></a><span class="co">#&gt;  6   667    0.00681</span></span>
<span id="cb18-16"><a></a><span class="co">#&gt;  7  1333    0.00681</span></span>
<span id="cb18-17"><a></a><span class="co">#&gt;  8  2000    0.00681</span></span>
<span id="cb18-18"><a></a><span class="co">#&gt;  9     1    0.0464 </span></span>
<span id="cb18-19"><a></a><span class="co">#&gt; 10   667    0.0464 </span></span>
<span id="cb18-20"><a></a><span class="co">#&gt; 11  1333    0.0464 </span></span>
<span id="cb18-21"><a></a><span class="co">#&gt; 12  2000    0.0464 </span></span>
<span id="cb18-22"><a></a><span class="co">#&gt; 13     1    0.316  </span></span>
<span id="cb18-23"><a></a><span class="co">#&gt; 14   667    0.316  </span></span>
<span id="cb18-24"><a></a><span class="co">#&gt; 15  1333    0.316  </span></span>
<span id="cb18-25"><a></a><span class="co">#&gt; 16  2000    0.316</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="update-parameter-ranges" class="slide level2">
<h2>Update parameter ranges <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb19" data-code-line-numbers="4-5|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a></a>b_param <span class="ot">&lt;-</span> </span>
<span id="cb19-2"><a></a>  b_wflow <span class="sc">|&gt;</span> </span>
<span id="cb19-3"><a></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span> </span>
<span id="cb19-4"><a></a>  <span class="fu">update</span>(<span class="at">trees =</span> <span class="fu">trees</span>(<span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">100</span>L)),</span>
<span id="cb19-5"><a></a>         <span class="at">learn_rate =</span> <span class="fu">learn_rate</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">5</span>, <span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb19-6"><a></a></span>
<span id="cb19-7"><a></a><span class="fu">set.seed</span>(<span class="dv">712</span>)</span>
<span id="cb19-8"><a></a>(grid <span class="ot">&lt;-</span> </span>
<span id="cb19-9"><a></a>  b_param <span class="sc">|&gt;</span> </span>
<span id="cb19-10"><a></a>  <span class="fu">grid_space_filling</span>(<span class="at">size =</span> <span class="dv">25</span>))</span>
<span id="cb19-11"><a></a><span class="co">#&gt; # A tibble: 25 × 2</span></span>
<span id="cb19-12"><a></a><span class="co">#&gt;    trees learn_rate</span></span>
<span id="cb19-13"><a></a><span class="co">#&gt;    &lt;int&gt;      &lt;dbl&gt;</span></span>
<span id="cb19-14"><a></a><span class="co">#&gt;  1     1  0.00215  </span></span>
<span id="cb19-15"><a></a><span class="co">#&gt;  2     5  0.000147 </span></span>
<span id="cb19-16"><a></a><span class="co">#&gt;  3     9  0.0215   </span></span>
<span id="cb19-17"><a></a><span class="co">#&gt;  4    13  0.0000215</span></span>
<span id="cb19-18"><a></a><span class="co">#&gt;  5    17  0.000681 </span></span>
<span id="cb19-19"><a></a><span class="co">#&gt;  6    21  0.00464  </span></span>
<span id="cb19-20"><a></a><span class="co">#&gt;  7    25  0.0464   </span></span>
<span id="cb19-21"><a></a><span class="co">#&gt;  8    29  0.0001   </span></span>
<span id="cb19-22"><a></a><span class="co">#&gt;  9    34  0.0000147</span></span>
<span id="cb19-23"><a></a><span class="co">#&gt; 10    38  0.001    </span></span>
<span id="cb19-24"><a></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="the-results" class="slide level2">
<h2>The results <img data-src="hexes/ggplot2.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell columns column-output-location" data-layout-align="center">
<div class="column">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a></a>grid <span class="sc">|&gt;</span> </span>
<span id="cb20-2"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(trees, learn_rate)) <span class="sc">+</span></span>
<span id="cb20-3"><a></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb20-4"><a></a>  <span class="fu">scale_y_log10</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/sfd-1.png" class="quarto-figure quarto-figure-center" style="width:70.0%"></p>
</figure>
</div>
</div>
</div></div>
<p>Note that the learning rates are uniform on the log-10 scale and this shows 2 of 4 dimensions.</p>
</section></section>
<section>
<section id="use-the-tune_-functions-to-tune-models" class="title-slide slide level1 center">
<h1>Use the <code>tune_*()</code> functions to tune models</h1>

</section>
<section id="choosing-tuning-parameters" class="slide level2">
<h2>Choosing tuning parameters <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/recipes.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "> <img data-src="hexes/parsnip.png" class="absolute" style="top: -20px; right: 192px; width: 64px; height: 74.24px; "></h2>
<p>Let’s take our previous model and tune more parameters:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="2,12-13|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a></a>b_mod <span class="ot">&lt;-</span> </span>
<span id="cb21-2"><a></a>  <span class="fu">boost_tree</span>(<span class="at">trees =</span> <span class="fu">tune</span>(), <span class="at">learn_rate =</span> <span class="fu">tune</span>(),  <span class="at">min_n =</span> <span class="fu">tune</span>()) <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a></a>  <span class="fu">set_mode</span>(<span class="st">"regression"</span>) <span class="sc">|&gt;</span> </span>
<span id="cb21-4"><a></a>  <span class="fu">set_engine</span>(<span class="st">"xgboost"</span>)</span>
<span id="cb21-5"><a></a></span>
<span id="cb21-6"><a></a>b_wflow <span class="ot">&lt;-</span> <span class="fu">workflow</span>(rec, b_mod)</span>
<span id="cb21-7"><a></a></span>
<span id="cb21-8"><a></a><span class="co"># Update the feature hash ranges (log-2 units)</span></span>
<span id="cb21-9"><a></a>b_param <span class="ot">&lt;-</span></span>
<span id="cb21-10"><a></a>  b_wflow <span class="sc">|&gt;</span></span>
<span id="cb21-11"><a></a>  <span class="fu">extract_parameter_set_dials</span>() <span class="sc">|&gt;</span></span>
<span id="cb21-12"><a></a>  <span class="fu">update</span>(<span class="at">trees =</span> <span class="fu">trees</span>(<span class="fu">c</span>(<span class="dv">1</span>L, <span class="dv">1000</span>L)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grid-search-2" class="slide level2">
<h2>Grid Search <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb22" data-code-line-numbers="2|"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a></a><span class="fu">set.seed</span>(<span class="dv">9</span>)</span>
<span id="cb22-2"><a></a>ctrl <span class="ot">&lt;-</span> <span class="fu">control_grid</span>(<span class="at">save_pred =</span> <span class="cn">TRUE</span>)</span>
<span id="cb22-3"><a></a></span>
<span id="cb22-4"><a></a>b_res <span class="ot">&lt;-</span></span>
<span id="cb22-5"><a></a>  b_wflow <span class="sc">|&gt;</span></span>
<span id="cb22-6"><a></a>  <span class="fu">tune_grid</span>(</span>
<span id="cb22-7"><a></a>    <span class="at">resamples =</span> folds,</span>
<span id="cb22-8"><a></a>    <span class="at">grid =</span> <span class="dv">25</span>,</span>
<span id="cb22-9"><a></a>    <span class="co"># The options below are not required by default</span></span>
<span id="cb22-10"><a></a>    <span class="at">param_info =</span> b_param, </span>
<span id="cb22-11"><a></a>    <span class="at">control =</span> ctrl,</span>
<span id="cb22-12"><a></a>    <span class="at">metrics =</span> <span class="fu">metric_set</span>(mae)</span>
<span id="cb22-13"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<aside class="notes">
<ul>
<li><code>tune_grid()</code> is representative of tuning function syntax</li>
<li>similar to <code>fit_resamples()</code></li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="grid-search-3" class="slide level2">
<h2>Grid Search <img data-src="hexes/workflows.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "> <img data-src="hexes/dials.png" class="absolute" style="top: -20px; right: 128px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a></a>b_res </span>
<span id="cb23-2"><a></a><span class="co">#&gt; # Tuning results</span></span>
<span id="cb23-3"><a></a><span class="co">#&gt; # 10-fold cross-validation </span></span>
<span id="cb23-4"><a></a><span class="co">#&gt; # A tibble: 10 × 5</span></span>
<span id="cb23-5"><a></a><span class="co">#&gt;    splits           id     .metrics          .notes           .predictions        </span></span>
<span id="cb23-6"><a></a><span class="co">#&gt;    &lt;list&gt;           &lt;chr&gt;  &lt;list&gt;            &lt;list&gt;           &lt;list&gt;              </span></span>
<span id="cb23-7"><a></a><span class="co">#&gt;  1 &lt;split [513/57]&gt; Fold01 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-8"><a></a><span class="co">#&gt;  2 &lt;split [513/57]&gt; Fold02 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-9"><a></a><span class="co">#&gt;  3 &lt;split [513/57]&gt; Fold03 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-10"><a></a><span class="co">#&gt;  4 &lt;split [513/57]&gt; Fold04 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-11"><a></a><span class="co">#&gt;  5 &lt;split [513/57]&gt; Fold05 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-12"><a></a><span class="co">#&gt;  6 &lt;split [513/57]&gt; Fold06 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-13"><a></a><span class="co">#&gt;  7 &lt;split [513/57]&gt; Fold07 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-14"><a></a><span class="co">#&gt;  8 &lt;split [513/57]&gt; Fold08 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-15"><a></a><span class="co">#&gt;  9 &lt;split [513/57]&gt; Fold09 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span>
<span id="cb23-16"><a></a><span class="co">#&gt; 10 &lt;split [513/57]&gt; Fold10 &lt;tibble [25 × 7]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [1,425 × 7]&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grid-results" class="slide level2">
<h2>Grid results <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell" data-layout-align="center">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a></a><span class="fu">autoplot</span>(b_res)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/autoplot-1.png" class="quarto-figure quarto-figure-center" style="width:80.0%"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="tuning-results" class="slide level2">
<h2>Tuning results <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a></a><span class="fu">collect_metrics</span>(b_res)</span>
<span id="cb25-2"><a></a><span class="co">#&gt; # A tibble: 25 × 9</span></span>
<span id="cb25-3"><a></a><span class="co">#&gt;    trees min_n learn_rate .metric .estimator  mean     n std_err .config              </span></span>
<span id="cb25-4"><a></a><span class="co">#&gt;    &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb25-5"><a></a><span class="co">#&gt;  1   458     2    0.00422 mae     standard   1.54     10  0.0259 Preprocessor1_Model01</span></span>
<span id="cb25-6"><a></a><span class="co">#&gt;  2   417     3    0.0590  mae     standard   0.347    10  0.0143 Preprocessor1_Model02</span></span>
<span id="cb25-7"><a></a><span class="co">#&gt;  3   833     5    0.0226  mae     standard   0.333    10  0.0133 Preprocessor1_Model03</span></span>
<span id="cb25-8"><a></a><span class="co">#&gt;  4   125     6    0.00536 mae     standard   5.34     10  0.0476 Preprocessor1_Model04</span></span>
<span id="cb25-9"><a></a><span class="co">#&gt;  5   708     8    0.196   mae     standard   0.359    10  0.0120 Preprocessor1_Model05</span></span>
<span id="cb25-10"><a></a><span class="co">#&gt;  6   791     9    0.00205 mae     standard   2.08     10  0.0300 Preprocessor1_Model06</span></span>
<span id="cb25-11"><a></a><span class="co">#&gt;  7    84    11    0.0464  mae     standard   0.405    10  0.0186 Preprocessor1_Model07</span></span>
<span id="cb25-12"><a></a><span class="co">#&gt;  8   250    13    0.316   mae     standard   0.356    10  0.0133 Preprocessor1_Model08</span></span>
<span id="cb25-13"><a></a><span class="co">#&gt;  9   292    14    0.00127 mae     standard   7.20     10  0.0562 Preprocessor1_Model09</span></span>
<span id="cb25-14"><a></a><span class="co">#&gt; 10   583    16    0.0110  mae     standard   0.353    10  0.0153 Preprocessor1_Model10</span></span>
<span id="cb25-15"><a></a><span class="co">#&gt; # ℹ 15 more rows</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choose-a-parameter-combination" class="slide level2">
<h2>Choose a parameter combination <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a></a><span class="fu">show_best</span>(b_res, <span class="at">metric =</span> <span class="st">"mae"</span>)</span>
<span id="cb26-2"><a></a><span class="co">#&gt; # A tibble: 5 × 9</span></span>
<span id="cb26-3"><a></a><span class="co">#&gt;   trees min_n learn_rate .metric .estimator  mean     n std_err .config              </span></span>
<span id="cb26-4"><a></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb26-5"><a></a><span class="co">#&gt; 1   833     5     0.0226 mae     standard   0.333    10  0.0133 Preprocessor1_Model03</span></span>
<span id="cb26-6"><a></a><span class="co">#&gt; 2   542    21     0.121  mae     standard   0.342    10  0.0146 Preprocessor1_Model13</span></span>
<span id="cb26-7"><a></a><span class="co">#&gt; 3   958    17     0.0750 mae     standard   0.344    10  0.0130 Preprocessor1_Model11</span></span>
<span id="cb26-8"><a></a><span class="co">#&gt; 4   750    30     0.249  mae     standard   0.346    10  0.0123 Preprocessor1_Model19</span></span>
<span id="cb26-9"><a></a><span class="co">#&gt; 5   417     3     0.0590 mae     standard   0.347    10  0.0143 Preprocessor1_Model02</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="choose-a-parameter-combination-1" class="slide level2">
<h2>Choose a parameter combination <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "></h2>
<p>Create your own tibble for final parameters or use one of the <code>tune::select_*()</code> functions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a></a>(b_best <span class="ot">&lt;-</span> <span class="fu">select_best</span>(b_res, <span class="at">metric =</span> <span class="st">"mae"</span>))</span>
<span id="cb27-2"><a></a><span class="co">#&gt; # A tibble: 1 × 4</span></span>
<span id="cb27-3"><a></a><span class="co">#&gt;   trees min_n learn_rate .config              </span></span>
<span id="cb27-4"><a></a><span class="co">#&gt;   &lt;int&gt; &lt;int&gt;      &lt;dbl&gt; &lt;chr&gt;                </span></span>
<span id="cb27-5"><a></a><span class="co">#&gt; 1   833     5     0.0226 Preprocessor1_Model03</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="checking-calibration" class="slide level2">
<h2>Checking Calibration <img data-src="hexes/tune.png" class="absolute" style="top: -20px; right: 0px; width: 64px; height: 74.24px; "> <img data-src="hexes/probably.png" class="absolute" style="top: -20px; right: 64px; width: 64px; height: 74.24px; "></h2>
<div class="cell columns column-output-location">
<div class="column">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a></a><span class="fu">library</span>(probably)</span>
<span id="cb28-2"><a></a></span>
<span id="cb28-3"><a></a>b_res <span class="sc">|&gt;</span></span>
<span id="cb28-4"><a></a>  <span class="fu">collect_predictions</span>(</span>
<span id="cb28-5"><a></a>    <span class="at">parameters =</span> b_best</span>
<span id="cb28-6"><a></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb28-7"><a></a>  <span class="fu">cal_plot_regression</span>(</span>
<span id="cb28-8"><a></a>    <span class="at">truth =</span> logC,</span>
<span id="cb28-9"><a></a>    <span class="at">estimate =</span> .pred</span>
<span id="cb28-10"><a></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div><div class="column">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="19-evaluation_files/figure-revealjs/b-cal-plot-1.png" style="width:90.0%"></p>
</figure>
</div>
</div>
</div></div>
</section>
<section id="the-final-fit" class="slide level2">
<h2>The final fit!</h2>
<p>Suppose that we are happy with our model.</p>
<p>Let’s fit the model on the training set and verify our performance using the test set.</p>
<div class="fragment">
<p>We’ve seen <code>fit()</code> and <code>predict()</code> (+ <code>augment()</code>) but there is a shortcut:</p>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a></a><span class="co"># the boosted tree workflow can be `finalized` with the best parameters</span></span>
<span id="cb29-2"><a></a>workflow <span class="ot">&lt;-</span> <span class="fu">finalize_workflow</span>(b_wflow, b_best)</span>
<span id="cb29-3"><a></a></span>
<span id="cb29-4"><a></a><span class="co"># forested_split has train + test info</span></span>
<span id="cb29-5"><a></a>(final_fit <span class="ot">&lt;-</span> <span class="fu">last_fit</span>(workflow, split))</span>
<span id="cb29-6"><a></a><span class="co">#&gt; # Resampling results</span></span>
<span id="cb29-7"><a></a><span class="co">#&gt; # Manual resampling </span></span>
<span id="cb29-8"><a></a><span class="co">#&gt; # A tibble: 1 × 6</span></span>
<span id="cb29-9"><a></a><span class="co">#&gt;   splits            id               .metrics         .notes           .predictions       .workflow </span></span>
<span id="cb29-10"><a></a><span class="co">#&gt;   &lt;list&gt;            &lt;chr&gt;            &lt;list&gt;           &lt;list&gt;           &lt;list&gt;             &lt;list&gt;    </span></span>
<span id="cb29-11"><a></a><span class="co">#&gt; 1 &lt;split [570/144]&gt; train/test split &lt;tibble [2 × 4]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble [144 × 4]&gt; &lt;workflow&gt;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="the-final-fit-1" class="slide level2">
<h2>The final fit!</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a></a><span class="fu">collect_metrics</span>(final_fit)</span>
<span id="cb30-2"><a></a><span class="co">#&gt; # A tibble: 2 × 4</span></span>
<span id="cb30-3"><a></a><span class="co">#&gt;   .metric .estimator .estimate .config             </span></span>
<span id="cb30-4"><a></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               </span></span>
<span id="cb30-5"><a></a><span class="co">#&gt; 1 rmse    standard       0.391 Preprocessor1_Model1</span></span>
<span id="cb30-6"><a></a><span class="co">#&gt; 2 rsq     standard       0.918 Preprocessor1_Model1</span></span>
<span id="cb30-7"><a></a></span>
<span id="cb30-8"><a></a><span class="fu">collect_predictions</span>(final_fit) <span class="sc">|&gt;</span> </span>
<span id="cb30-9"><a></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(.pred, logC)) <span class="sc">+</span></span>
<span id="cb30-10"><a></a>  <span class="fu">geom_point</span>() <span class="sc">+</span> </span>
<span id="cb30-11"><a></a>  <span class="fu">geom_abline</span>() <span class="sc">+</span> </span>
<span id="cb30-12"><a></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">"lm"</span>, <span class="at">se =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="19-evaluation_files/figure-revealjs/unnamed-chunk-19-1.png" style="width:100.0%" class="r-stretch"></section>
<section id="the-whole-game" class="slide level2">
<h2>The whole game</h2>

<img data-src="images/whole-game-final-performance.jpg" class="quarto-figure quarto-figure-center r-stretch" style="width:100.0%"></section>
<section id="assignment" class="slide level2">
<h2>Assignment</h2>
<p>Starting with the “Whole Game Image” on the last slide, in plain language, write a sentence or 2 about each step and item, its importance, and note key things to be careful of. The full submission should be a 2-3 paragraph narative of the entire process, including the final model fit and performance.</p>


</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<p><img src="../csu-rams-logo.png" class="slide-logo"></p>
<div class="footer footer-default">
<p><a href="https://github.com/mikejohnson51/csu-ess-330/">ESS 330: Quantitative Reasoning for Ecosystem Science</a></p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="../site_libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="../site_libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="../site_libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="../site_libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="../site_libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="../site_libs/revealjs/plugin/notes/notes.js"></script>
  <script src="../site_libs/revealjs/plugin/search/search.js"></script>
  <script src="../site_libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="../site_libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'smaller': true,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: 'c/t',

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'none',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1280,

        height: 720,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    <script>
      Reveal.addEventListener( 'slidechanged', function( event ) {
        console.log("hello")
        
        slide_id = event.currentSlide.id
        link = "annotations" + ".html#" + slide_id
        
        var annotation_div = document.createElement('div')
        annotation_div.setAttribute("class", "annotation-link")
        
        var notes_link = document.createElement('a')
        notes_link.setAttribute("href", link)
        notes_link.setAttribute("target", "_blank")
        
        var iii = document.createElement('i')
        iii.setAttribute("class", "fa fa-info")
        notes_link.appendChild(iii)
        
        annotation_div.appendChild(notes_link)
        
        var tmp = event.currentTarget.getElementsByClassName("annotation-link")
        if (tmp.length === 1) {
          tmp[0].remove()
        }
        
        if (event.currentSlide.classList.contains("annotation")) {
          event.currentTarget.append(annotation_div)
        }
      } );

    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>